<div id="upper-bar">
  <mat-form-field>
    <mat-label>Wybierz tydzień</mat-label>
    <mat-date-range-input [rangePicker]="picker" [formGroup]="range">
      <input matStartDate formControlName="start" (dateChange)="requestData()">
      <input matEndDate formControlName="end" (dateChange)="requestData()">
    </mat-date-range-input>
    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-date-range-picker #picker></mat-date-range-picker>
  </mat-form-field>
  <button mat-icon-button (click)="requestData()"><mat-icon>refresh</mat-icon></button>
  <button mat-icon-button (click)="addDate()"><mat-icon>add</mat-icon></button>
  <button mat-icon-button (click)="print()"><mat-icon>print</mat-icon></button>
</div>
@if (loading) {
  <mat-spinner></mat-spinner>
}
<table mat-table [dataSource]="dataSource">
  <div matColumnDef="day">
    <th mat-header-cell *matHeaderCellDef>Dzień</th>
    <td mat-cell *matCellDef="let element">
      <span>{{element.day.toFormat('dd.LL.yyyy')}}r.</span>
      <p>{{element.day.toFormat('cccc') | titlecase }}</p>
      <app-field-editor category="Nazwa" [(word)]="element.dayTitle" (wordChange)="editTitle(element._id)"/><br><hr>
      <button (click)="remove(element._id)">Usuń dzień</button>
    </td>
  </div>
  <div matColumnDef="sn">
    <th mat-header-cell *matHeaderCellDef>Śniadanie</th>
    <td mat-cell *matCellDef="let element">
      <ul class="non-editable">
        @for (i of ls.defaultItems.sn; track i) {
          <li>{{i}}</li>
        }
      </ul><hr>
      <app-list-editor [(list)]="element.sn.fancy" (edit)="editSn(element._id)" dataList="sn-fancy"/><hr>
      <ul>
        <li><app-field-editor category="II Śniadanie" [(word)]="element.sn.second" list="sn-second" (wordChange)="editSn(element._id)"/></li>
      </ul>
    </td>
  </div>
  <div matColumnDef="ob">
    <th mat-header-cell *matHeaderCellDef>Obiad</th>
    <td mat-cell *matCellDef="let element">
      <ul>
        <li><app-field-editor category="Zupa" [(word)]="element.ob.soup" list="ob-soup" (wordChange)="editOb(element._id)"/></li>
        <li><app-field-editor category="Vege" [(word)]="element.ob.vege" list="ob-vege" (wordChange)="editOb(element._id)"/></li>
        <li><app-field-editor category="Danie główne" [(word)]="element.ob.meal" list="ob-meal" (wordChange)="editOb(element._id)"/></li>
      </ul><hr>
      <app-list-editor [(list)]="element.ob.condiments" (edit)="editOb(element._id)" dataList="ob-condiments"/><hr>
      <ul>
        <li><app-field-editor category="Napój" [(word)]="element.ob.drink" list="ob-drink" (wordChange)="editOb(element._id)"/></li>
      </ul><hr>
      <app-list-editor [(list)]="element.ob.other" (edit)="editOb(element._id)" dataList="ob-other"/>
      <button (click)="getStat(element.day, 'ob')">
        Opinie wychowanków
      </button>
    </td>
  </div>
  <div matColumnDef="kol">
    <th mat-header-cell *matHeaderCellDef>Kolacja</th>
    <td mat-cell *matCellDef="let element">
      <div>
        @switch (element.day.weekday) {
          @default {
            <div>
              <ul class="non-editable">
                @for (i of ls.defaultItems.kol; track i) {
                  <li>{{i}}</li>
                }
              </ul><hr>
              <ul>
                <li><app-field-editor category="Kolacja" [(word)]="element.kol" list="kol" (wordChange)="editKol(element._id)"/></li>
              </ul>
              <button (click)="getStat(element.day, 'kol')">
                Opinie wychowanków
              </button>
            </div>
          }
          @case (5) {
            <div class="non-editable">
              <p>Kolacja w domu!</p>
              <p>(Nie edytowalne)</p>
            </div>
          }
        }
      </div>
    </td>
  </div>

  <tr mat-header-row *matHeaderRowDef="dcols"></tr>
  <tr mat-row *matRowDef="let row; columns: dcols"></tr>
</table>

@if (options) {
  <datalist id="sn-fancy">
    @for (i of options.sn.fancy; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="sn-second">
    @for (i of options.sn.second; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="ob-soup">
    @for (i of options.ob.soup; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="ob-vege">
    @for (i of options.ob.vege; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="ob-meal">
    @for (i of options.ob.meal; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="ob-condiments">
    @for (i of options.ob.condiments; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="ob-drink">
    @for (i of options.ob.drink; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="ob-other">
    @for (i of options.ob.other; track i) {
      <option>{{i}}</option>
    }
  </datalist>
  <datalist id="kol">
    @for (i of options.kol; track i) {
      <option>{{i}}</option>
    }
  </datalist>
}